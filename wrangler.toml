# Configuración de Cloudflare Workers para la API Editorial de Ecdotica
# Editorial Nuevo Milenio - Sistema de Gestión de Manuscritos

name = "ecdotica-api"
main = "src/api/main.py"
compatibility_date = "2025-11-19"
workers_dev = true

# ==========================================
# VARIABLES GLOBALES (Todos los entornos)
# ==========================================
[vars]
API_VERSION = "2.0.0"
EDITORIAL_NAME = "Editorial Nuevo Milenio"
API_DESCRIPTION = "Sistema de gestión editorial y análisis de manuscritos"

# ==========================================
# ENTORNO DE PRODUCCIÓN
# ==========================================
[env.production]
name = "ecdotica-api"
route = { pattern = "api.ecdotica.com/*", zone_name = "ecdotica.com" }

[env.production.vars]
ENVIRONMENT = "production"

# Configuración de análisis de manuscritos
ENABLE_AUTO_ANALYSIS = "true"
MIN_WORD_COUNT = "5000"  # Mínimo de palabras para considerar manuscrito completo
MIN_QUALITY_SCORE = "70"  # Puntaje mínimo de calidad (0-100)
MAX_MANUSCRIPT_SIZE = "500000"  # Tamaño máximo en caracteres

# Configuración de CORS
CORS_ORIGINS = "https://ecdotica.com,https://www.ecdotica.com"
CORS_ALLOW_CREDENTIALS = "true"

# Configuración de notificaciones (futuro)
NOTIFY_ON_SUBMISSION = "true"
NOTIFY_EMAIL = "editorial@nuevomilenio.com"

# Bases de datos (placeholder para futuras integraciones)
# DATABASE_URL = "postgresql://..."  # Descomentable cuando uses DB

# ==========================================
# ENTORNO DE DESARROLLO
# ==========================================
[env.dev]
name = "ecdotica-api-dev"
# Sin route - usar workers.dev por defecto

[env.dev.vars]
ENVIRONMENT = "development"

# Configuración de análisis (más permisiva para pruebas)
ENABLE_AUTO_ANALYSIS = "true"
MIN_WORD_COUNT = "100"  # Bajo para testing
MIN_QUALITY_SCORE = "50"  # Bajo para testing
MAX_MANUSCRIPT_SIZE = "1000000"

# CORS abierto para desarrollo
CORS_ORIGINS = "*"
CORS_ALLOW_CREDENTIALS = "false"

# Notificaciones deshabilitadas en dev
NOTIFY_ON_SUBMISSION = "false"

# ==========================================
# ENTORNO DE STAGING (Opcional)
# ==========================================
[env.staging]
name = "ecdotica-api-staging"

[env.staging.vars]
ENVIRONMENT = "staging"
ENABLE_AUTO_ANALYSIS = "true"
MIN_WORD_COUNT = "1000"
MIN_QUALITY_SCORE = "60"
MAX_MANUSCRIPT_SIZE = "500000"
CORS_ORIGINS = "https://staging.ecdotica.com"

# ==========================================
# NOTAS DE USO
# ==========================================
# 
# Para desplegar:
#   - Desarrollo:  wrangler deploy --env dev
#   - Staging:     wrangler deploy --env staging
#   - Producción: wrangler deploy --env production
#
# Para usar dominio personalizado (api.ecdotica.com):
#   1. Asegúrate de que ecdotica.com esté en Cloudflare
#   2. Configura el DNS para apuntar a tu Worker
#   3. Ejecuta: wrangler deploy --env production
#
# Endpoints disponibles:
#   POST /api/v1/manuscripts/submit      - Enviar manuscrito
#   POST /api/v1/manuscripts/analyze     - Analizar manuscrito
#   POST /api/v1/manuscripts/decision    - Registrar decisión editorial
#   GET  /api/v1/manuscripts/quick-eval  - Evaluación rápida
#   GET  /health                          - Health check
